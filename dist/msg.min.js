/* Msg 2014-11-19 */
(function(t){function n(t){return function(n){return l.call(n)==="[object "+t+"]"}}function r(t,n){return null!=t&&h.call(t,n)}function e(t){if(!d(t))return[];if(Object.keys)return Object.keys(t);var n=[];for(var e in t)r(t,e)&&n.push(e);return n}function i(t){for(var n=e(t),r=n.length,i=Array(r),a=0;r>a;a+=1)i[a]=t[n[a]];return i}function a(n,e,i){var a=n.length;if(a===+a&&a){for(var s=0;a>s;s+=1)if(e.call(i||t,n[s],s,n)===!1)return n;return n}for(var c in n)if(r(n,c)&&e.call(i||t,n[c],c,n)===!1)return n;return n}function s(){var t,n=arguments[0];if("boolean"==typeof n&&(t=n,n=arguments[1]),!d(n))return n;var r=p.call(arguments,t?2:1);return a(r,function(r){d(r)&&a(r,function(r,e){if(t&&d(r)){var i=n[e];return n[e]=d(i)?i:{},s(t,n[e],r)}n[e]=r})}),n}function c(t){throw Error(t)}function u(){return this instanceof u?(this._reactions={},undefined):new u}var o=Object.prototype,f=Array.prototype,l=o.toString,h=o.hasOwnProperty,p=f.slice;f.push;var d=n("Object"),y=n("String"),_=n("Function"),g=Array.isArray||n("Array"),v="undefined"!=typeof process&&process.nextTick||function(t){return setTimeout(t,0)},m=u.prototype={_add:function(t,n){return this._reactions[t]=this._reactions[t]||[],this._reactions[t].push(n),this},on:function(t,n){if(_(n)||c(n+"不是一个函数"),y(t))this._add(t,n);else if(g(t)){var r=this;a(t,function(t){y(t)&&r._add(t,n)})}return this},_react:function(n){var e=p.call(arguments,1);return y(n)&&r(this._reactions,n)&&a(this._reactions[n],function(r){r.msgType=n,r.apply(t,e)}),this},spread:function(t){var n=this,r=p.call(arguments);return t?y(t)?this._react.apply(n,r):g(t)&&(r=r.slice(1),a(t,function(t){n._react.apply(n,[t].concat(r))})):(r=r.slice(1),a(e(this._reactions),function(t){n._react.apply(n,[t].concat(r))})),this},_cancel:function(t,n){var e;if(y(t)&&r(this._reactions,t)){e=this._reactions[t];for(var i=e.length-1;i>=0;i--)if(e[i]===n){v(function(){e.splice(i,1)});break}}return this},off:function(t,n){var r=this;return t?g(t)?a(t,function(t){r._reactions[t]=[]}):_(n)?this._cancel(t,n):y(t)&&(this._reactions[t]=[]):this._reactions={},this}};s(m,{once:function(n,r){function e(){r.apply(t,arguments),i._cancel(n,e)}var i=this;return this._add(n,e)},hold:function(n,r,e){function i(){0>=--r&&e.apply(t,arguments)}return r===+r&&r>=0||c(r+"不是一个正整数"),this._add(n,i),i},tie:function(n,e,i){function s(){if(r(f,s.msgType)&&(delete f[s.msgType],l[s.msgType]=1===arguments.length?arguments[0]:p.call(arguments),++o>=u)){var c=[];a(n,function(t){c.push(l[t]),i&&that._cancel(t,s)}),e.apply(t,c)}}if(_(e)||c(e+"不是一个函数"),g(n)){var u=0,o=0,f={},l={};a(n,function(t){y(t)&&(f[t]=l[t]=1,u+=1)}),this.on(n,s)}else y(n)&&this._add(n,e);return this},tick:function(){var t=p.call(arguments),n=this;return v(function(){n.spread.apply(n,t)}),this},delay:function(t){var n=p.call(arguments,1),r=this;return setTimeout(function(){r.spread.apply(r,n)},t||4),this}}),s(m,{isObj:d,isFn:_,isStr:y,isArr:g,keys:e,has:r,values:i,each:a,extend:s,nextTick:v}),"function"==typeof define?define(function(){return u}):"undefined"!=typeof module&&d(module.exports)&&d(exports)?module.exports=u:t.Msg=u})(this);